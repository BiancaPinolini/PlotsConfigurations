# Make the histogram files - splitting is extreme, you'll get more than a thousand jobs
mkShapes.py --doBatch=1 --batchSplit=AsMuchAsPossible --batchQueue=microcentury

# Some jobs die silently. We could somehow use batchTools, but it's easier to just resubmit based on which root files are missing
../tools/resubmit.py

# Merging function of mkShapes.py doesn't work any more with the extremely large number of cuts and samples
../tools/submit_merge_plots.py

# Make datacards out of per-sample root files. pTH specific structure file in use.
mkDatacards.py --inputFile=rootFile_merged --structureFile=structure_pth.py

# Massage and combine the datacards
../tools/fitting/combine_cards_pth.py

# Asimov fit with mu_i=1
PARAMS=
for I in {0..5}
do
  PARAMS=${PARAMS}r_${I}=1.0,
done

PARAMS=delta=10.

combine -M MultiDimFit datacards_fullmodel/fullmodel.root --algo none -t -1 --setParameters $PARAMS --saveWorkspace --saveFitResult
